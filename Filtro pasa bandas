import pandas as pd
import matplotlib.pyplot as plt
from scipy.signal import butter, filtfilt

# Ruta base
ruta = r"C:\Users\Angel\Downloads"

# Cargar datos
temperatura = pd.read_csv(ruta + r"\temperatura.csv")
humedad = pd.read_csv(ruta + r"\humedad.csv")
viento = pd.read_csv(ruta + r"\viento.csv")

# Ajustar tiempo
intervalo = 5  # segundos
fs = 1 / intervalo  # 0.2 Hz
temperatura["Tiempo"] = temperatura.index * intervalo
humedad["Tiempo"] = humedad.index * intervalo
viento["Tiempo"] = viento.index * intervalo

# --- Filtro pasa bandas ---
def filtro_pasa_bandas(senal, f_low=0.01, f_high=0.09, orden=2):
    b, a = butter(orden, [f_low, f_high], btype='band')
    return filtfilt(b, a, senal)

# Aplicar filtro
temperatura["Pasa_Bandas"] = filtro_pasa_bandas(temperatura["Temperatura_C"])
humedad["Pasa_Bandas"] = filtro_pasa_bandas(humedad["Humedad_Relativa_%"])
viento["Pasa_Bandas"] = filtro_pasa_bandas(viento["Velocidad_Viento_mps"])

# --- Gráfica original vs pasa bandas ---
def graficar_pasa_bandas(df, columna, nombre_sensor, unidad):
    plt.figure(figsize=(10, 4))
    plt.plot(df["Tiempo"], df[columna], label="Original", alpha=0.6)
    plt.plot(df["Tiempo"], df["Pasa_Bandas"], label="Pasa Bandas (0.01–0.09)", linewidth=2)
    plt.title(f"{nombre_sensor} - Filtro Pasa Bandas")
    plt.xlabel("Tiempo (s)")
    plt.ylabel(unidad)
    plt.grid(True)
    plt.legend()
    plt.tight_layout()
    plt.show()

# Temperatura
graficar_pasa_bandas(temperatura, "Temperatura_C", "Temperatura", "°C")

# Humedad
graficar_pasa_bandas(humedad, "Humedad_Relativa_%", "Humedad", "% HR")

# Viento
graficar_pasa_bandas(viento, "Velocidad_Viento_mps", "Viento", "m/s")
